<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>orders-product welcome!</title>
  <script type="text/javascript" src="js/jquery.min.js" ></script>
  <style>
  dl dt {float:left}
  </style>
  <script type="text/javascript">
  function dateFtt(date,fmt){   
    var o = {   
      "M+" : date.getMonth()+1,                 //月份   
      "d+" : date.getDate(),                    //日   
      "H+" : date.getHours(),                   //小时   
      "m+" : date.getMinutes(),                 //分   
      "s+" : date.getSeconds(),                 //秒   
      "q+" : Math.floor((date.getMonth()+3)/3), //季度   
      "S"  : date.getMilliseconds()             //毫秒   
    };   
    if(/(y+)/.test(fmt))   
      fmt=fmt.replace(RegExp.$1, (date.getFullYear()+"").substr(4 - RegExp.$1.length));   
    for(var k in o)   
      if(new RegExp("("+ k +")").test(fmt))   
    fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));   
    return fmt;   
  } 
  
  $(function (){
	  $('body').on('click','#searchBtn,.page',function(){
		  var pageNo = $(this).attr("pageNo");
		  if(!pageNo || isNaN(pageNo) )
			  pageNo=1;
		  //alert(pageNo);
		  var data = {"productCode":$('#productCode').val(),"productName":$('#productName').val(),"pageNo":pageNo,"pageSize":10,needFullTypeName:true};
		  $.ajax({  
			    url:"product/search",
			    type:"GET",  
			    dataType:"json",  
			    data:data,  
			    contentType: "application/json;charset=utf-8",
			    headers: {'Content-Type': 'application/json;charset=UTF-8'},  
			    success: function (ret) {  
			    	if(ret.code!='0'){
			    		alert(ret.code+":"+ret.msg);
			    		return;
			    	}
			    	var $tr = $('#listTable tbody').empty();
			    	for(var i in ret.resultList){
			    		var p = ret.resultList[i];
			    		//alert("p:"+p);
			    		$tr.append('<tr> <td>'+p.productCode+'</td><td>'+p.productName+'</td><td>'+(p.productPrice/1000)+'</td>'
			    				+'<td>'+p.storeName+'</td><td>'+p.fullProductTypeName+'</td><td>'+dateFtt(new Date(p.updateTime),'yyyy-MM-dd HH:mm:ss.S')+'</td> </tr>');
			    		
			    	}
			    	makePageInfo(ret);
			    },
			    error:function(err){
			    	//alert("网络异常："+err.responseText);
			    	alert("网络异常："+err.status);
			    }
		  });
		  
	  });
	  
	  function makePageInfo(page){
		  var pageNo = page.pageNo;
		  var pageSize = page.pageSize;
		  var totalCount = page.totalCount;
		  var totalPages = page.totalPages;
		  var pageContetxt = '';
		  if(pageNo>1){
			  pageContetxt += ' <a href="javacript:void(0)" class="page" pageNo="1">首页</a> ';
			  pageContetxt += ' <a href="javacript:void(0)" class="page" pageNo="'+(pageNo-1)+'">上一页</a> ';
		  }
		  pageContetxt += ' 第'+pageNo+'页/共'+totalPages+'页 ';
		  if(pageNo<totalPages){
			  pageContetxt += ' <a href="javacript:void(0)" class="page" pageNo="'+(pageNo+1)+'">下一页</a> ';
			  pageContetxt += ' <a href="javacript:void(0)" class="page" pageNo="'+totalPages+'">尾页</a> ';
		  }
		  $('#pageTd').empty().append(pageContetxt);
	  }
	  
  });
  </script>
</head>
<body>
	<header>
		<h1 style="text-align:center">欢迎访问 orders商品管理系统</h1>
	</header>
	<br>
	<section style="margin:10px auto;width:80%">
		商品代码<input id="productCode" type="text" value="" >
		商品名称<input id="productName" type="text" value="" > 
		<button id="searchBtn" >搜索</button>
	</section>
	<div id="content" style="margin:10px auto;width:80%">
	 	<table id="listTable" style="width:100%">
	 		<thead>
	 			<tr>
	 				<th>code</th>
	 				<th>name</th>
	 				<th>price</th>
	 				<th>store name</th>
	 				<th>type name</th>
	 				<th>update time</th>
	 			</tr>
	 		</thead>
	 		<tbody>
	 			
	 		</tbody>
	 		<tfoot>
	 			<tr>
	 				<td colspan="7" id="pageTd" ></td>
	 			</tr>
	 		</tfoot>
	 	</table>
	</div>
	<div id="pageFoot">
		
	</div>
</body>
</html>